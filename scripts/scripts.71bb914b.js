!function(){"use strict";angular.module("auction",["ngRoute","restangular"]).config(["$routeProvider",function(a){var b=function(a){return a+" | Магазин"};a.when("/",{templateUrl:"views/home.html",controller:"HomeController",controllerAs:"ctrl",title:b("Главная")}).when("/search",{templateUrl:"views/search.html",controller:"SearchController",controllerAs:"ctrl",reloadOnSearch:!1,title:b("Поиск")}).when("/contacts",{templateUrl:"views/contacts.html",controller:"ContactsController",controllerAs:"ctrl",title:b("Контакты")}).when("/basket",{templateUrl:"views/basket.html",controller:"BasketController",controllerAs:"ctrl",title:b("Корзина")}).when("/product/:productId",{templateUrl:"views/product.html",controller:"ProductController",controllerAs:"ctrl",title:b("Описание продукта"),resolve:{product:["$route","ProductService",function(a,b){var c=a.current.params.productId;return b.getProductById(c)}]}}).otherwise({redirectTo:"/"})}]).config(["RestangularProvider",function(a){a.setBaseUrl("http://95.85.47.177"),a.setRequestSuffix(".json")}]).run(["$rootScope",function(a){a.$on("$routeChangeStart",function(b,c){a.pageTitle=c.$$route.title})}])}(),function(){"use strict";var a=function(a){var b=this;b.products=[],a.getProducts().then(function(a){b.products=a})};a.$inject=["ProductService"],angular.module("auction").controller("HomeController",a)}(),function(){"use strict";var a=function(a,b,c,d){this.$location=a,this.searchFormService=b,this.product=c,this.basketService=d};a.prototype={find:function(){this.$location.path("/search").search(this.searchFormService.toRequestParams())},addToBasket:function(){this.basketService.addProduct(this.product.value)},getCountInBasket:function(){return this.basketService.getCountById(this.product.value.id)},getBasketButtonTitle:function(){var a=this.basketService.getCountById(this.product.value.id);return 0==a?"В корзину":"В корзине ("+a+")"}},a.$inject=["$location","SearchFormService","product","BasketService"],angular.module("auction").controller("ProductController",a)}(),function(){"use strict";var a=function(a,b,c){this.$location=a,this.productService=b,this.searchFormService=c;var d=c.fromRequestParams(a.search());_.isEmpty(d)||this.find()};a.prototype={find:function(){var a=this.searchFormService.toRequestParams();this.$location.search(a),this.productService.find(a).then(function(a){this.products=a}.bind(this))}},a.$inject=["$location","ProductService","SearchFormService"],angular.module("auction").controller("SearchController",a)}(),function(){"use strict";var a=function(a){var b=this;b.products=a.getProducts(),b.removeFromBasket=function(c){a.removeFromBasket(c),b.products=a.getProducts()},b.check=function(){return a.check()}};a.$inject=["BasketService"],angular.module("auction").controller("BasketController",a)}(),function(){"use strict";var a=function(a){var b=this;b.username="",b.full_name="",b.profile_picture="",b.bio="",a.getUser().then(function(a){b.username=a.username,b.full_name=a.full_name,b.profile_picture=a.profile_picture,b.bio=a.bio.split(";")})};a.$inject=["ContactsService"],angular.module("auction").controller("ContactsController",a)}(),function(){"use strict";var a=function(){return{scope:!1,restrict:"A",link:function(a,b){b.datepicker({startDate:"-0d"})}}};angular.module("auction").directive("auctionDatepicker",a)}(),function(){"use strict";var a=function(){return{scope:!1,restrict:"E",templateUrl:"views/partial/FooterDirective.html"}};angular.module("auction").directive("auctionFooter",a)}(),function(){"use strict";var a=function(){return{cope:{productsCount:"="},restrict:"E",templateUrl:"views/partial/NavbarDirective.html",controller:["$scope","$location","$route","ContactsService","BasketService",function(a,b,c,d,e){a.cmp=this,a.basketService=e,d.getUser().then(function(b){a.title=b.username}),this.search=function(){b.path("/search").search({title:this.productTitle}),this.productTitle=null,c.reload()}}]}};angular.module("auction").directive("auctionNavbar",a)}(),function(){"use strict";var a=function(){return{scope:{minPrice:"@",maxPrice:"@",lowPrice:"=",highPrice:"="},restrict:"E",templateUrl:"views/partial/PriceRangeDirective.html",link:function(a,b){var c=angular.element(b).find("input[type=text]"),d=a.minPrice||0,e=a.maxPrice||1e4;a.lowPrice=a.lowPrice||d,a.highPrice=a.highPrice||e,c.slider({min:d,max:e,value:[a.lowPrice,a.highPrice]}),c.on("slideStop",function(b){a.$apply(function(){a.lowPrice!==b.value[0]&&(a.lowPrice=b.value[0]),a.highPrice!==b.value[1]&&(a.highPrice=b.value[1])})});var f=function(){return c.slider("getValue")},g=function(a,b){c.slider("setValue",[a,b])};a.$watch("lowPrice",function(a){g(a||d,f()[1])}),a.$watch("highPrice",function(a){g(f()[0],a||e)})}}};angular.module("auction").directive("auctionPriceRange",a)}(),function(){"use strict";var a=function(){return{scope:!1,restrict:"E",templateUrl:"views/partial/SearchFormDirective.html"}};angular.module("auction").directive("auctionSearchForm",a)}(),function(){"use strict";function a(a,c){var d=[];try{for(var e=0;e<c.length;e++)a.id!=c[e].id&&b(a,c[e])&&d.push(c[e])}catch(f){}for(var e=0;d.length<3&&e!=c.length;)a.id!=c[e].id&&-1==d.indexOf(c[e])&&d.push(c[e]),e++;return d}function b(a,b){for(var c=a.color.split(","),d=0;d<c.length;d++)if(b.color.indexOf(c[d].replace(" ",""))>-1)return!0;return!1}var c=function(a){this.Restangular=a};c.$inject=["Restangular"],c.prototype={getProducts:function(){return this.Restangular.all("2202560790_medias").getList()},find:function(a){return this.Restangular.all("2202560790_medias").getList().then(function(b){for(var c=[],d=0;d<b.length;d++)a.lowPrice&&a.lowPrice>b[d].price||a.highPrice&&a.highPrice<b[d].price||(!a.title||b[d].title.toLowerCase().includes(a.title.toLowerCase()))&&c.push(b[d]);return c})},getProductById:function(b){return this.Restangular.all("2202560790_medias").getList().then(function(c){for(var d=0;d<c.length;d++)if(c[d].id==b){var e=c[d],f=a(e,c);return{value:e,same:f}}return null})}},angular.module("auction").service("ProductService",c)}(),function(){"use strict";var a=function(a){this.Restangular=a};a.$inject=["Restangular"],a.prototype={getUser:function(){return this.Restangular.one("2202560790_user").get()}},angular.module("auction").service("ContactsService",a)}(),function(){"use strict";var a=function(){this._highPrice=b.highPrice},b={category:0,lowPrice:0,highPrice:1e4,title:""},c=function(a){return _.reduce(a,function(a,c,d){return 0===d.indexOf("_")&&(d=d.substring(1)),_.isString(c)&&_.isEmpty(c.trim())?a:(_.isNull(c)||_.isNaN(c)||c===b[d]||(a[d]=c),a)},{})};a.prototype={get lowPrice(){return this._lowPrice},set lowPrice(a){this._lowPrice=parseFloat(a)},get highPrice(){return this._highPrice},set highPrice(a){this._highPrice=parseFloat(a)},get category(){return this._category},set category(a){this._category=parseInt(a)},toRequestParams:function(){return c(this)},fromRequestParams:function(a){var b=c(a);return _.assign(this,b),b}},a.$inject=[],angular.module("auction").service("SearchFormService",a)}(),function(){"use strict";var a=function(){this.products=[]};a.prototype={getProducts:function(){return this.products},addProduct:function(a){for(var b=-1,c=0;c<this.products.length;c++)this.products[c].id==a.id&&(b=c);b>-1?this.products[b].count++:(a.count=1,this.products.push(a))},getCount:function(){return this.products.length>0?"("+this.products.length.toString()+")":""},getCountById:function(a){for(var b=0;b<this.products.length;b++)if(this.products[b].id==a)return this.products[b].count;return 0},removeFromBasket:function(a){for(var b=[],c=0;c<this.products.length;c++)this.products[c].id!=a&&b.push(this.products[c]);this.products=b},check:function(){for(var a=0,b=0;b<this.products.length;b++)a+=this.products[b].count*this.products[b].price;return a}},angular.module("auction").service("BasketService",a)}();